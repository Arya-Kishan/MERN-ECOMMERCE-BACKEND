import{B as I,u as O,a as m,N as F,s as P,x as E,r as d,c as L,aq as M,ar as T,O as D,as as q,at as _,j as e,au as U,K as V,av as B,aw as H}from"./index-vogP14HX.js";import{l as K}from"./stripe.esm-nTdSkmMw.js";function Q(){const{register:i,handleSubmit:b,watch:R,formState:{errors:Y}}=I(),l=O(),r=m(F),x=m(P),{userId:o}=E(),[g,u]=d.useState(""),[h,N]=d.useState(""),[v,f]=d.useState(!1),w=L(),y=m(M),p=m(T),C=(s,t)=>{t.preventDefault();let a={id:o,addresses:[...x.addresses,s]};l(U(a))},k=s=>{let t=s.map(n=>n.itemId._id),a=s.map(n=>({quantity:n.quantity})),j=0;if((s==null?void 0:s.length)>0&&(j=s.map(c=>c.itemId.price*c.quantity).reduce((c,S)=>c+S)),g==""||h=="")V("PLEASE SELECT BOTH PAYMENT METHOD AND ADDRESS");else{let n={userId:x._id,itemId:t,paymentMethod:g,selectedAddresses:h,status:"pending",totalAmount:j,totalQuantity:a};l(B(n)),l(H(o)),g=="card"&&A()}},A=async()=>{const s=await K("pk_test_51OTSOaSCLk89VVV2y65ICM1KafKVLbOIhdp06xHCYFST0x3lQGymFiCjyl2Ji6qOcmmugvwPipgsLxtF6bDOhcNM00Msw33mYG"),a=await(await fetch("/create-checkout-session",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(r)})).json();console.log(a),s.redirectToCheckout({sessionId:a.id})};return d.useEffect(()=>{l(D(o))},[o]),d.useEffect(()=>{y=="Placed"&&(l(q()),console.log("navigating to order success"),l(_(p)),w(`/orderSuccess/${p._id}`))},[y]),e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-[1.3fr,0.7fr]",children:[e.jsxs("form",{className:"p-5",onSubmit:b((s,t)=>{C(s,t)}),children:[v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-12",children:e.jsxs("div",{className:"border-b border-gray-900/10 pb-12",children:[e.jsx("h2",{className:"text-base font-semibold leading-7 text-gray-900",children:"Add Address"}),e.jsxs("div",{className:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"firstName",className:"block text-sm font-medium leading-6 text-gray-900",children:"First name"}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",...i("firstName"),id:"firstName",autoComplete:"given-name",className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium leading-6 text-gray-900",children:"Last name"}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",...i("lastName"),id:"lastName",autoComplete:"family-name",className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),e.jsxs("div",{className:"sm:col-span-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium leading-6 text-gray-900",children:"Email address"}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{id:"email",...i("email"),type:"email",autoComplete:"email",className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"country",className:"block text-sm font-medium leading-6 text-gray-900",children:"Country"}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{id:"country",...i("country"),autoComplete:"country-name",className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6",children:[e.jsx("option",{children:"India"}),e.jsx("option",{children:"Nepal"}),e.jsx("option",{children:"Sri Lanka"})]})})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx("label",{htmlFor:"street",className:"block text-sm font-medium leading-6 text-gray-900",children:"Street address"}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",...i("street"),id:"street",autoComplete:"street",className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),e.jsxs("div",{className:"sm:col-span-2 sm:col-start-1",children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-medium leading-6 text-gray-900",children:"City"}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",...i("city"),id:"city",autoComplete:"address-level2",className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"state",className:"block text-sm font-medium leading-6 text-gray-900",children:"State / Province"}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",...i("state"),id:"state",autoComplete:"address-level1",className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"pinCode",className:"block text-sm font-medium leading-6 text-gray-900",children:"ZIP / Postal code"}),e.jsx("div",{className:"mt-2",children:e.jsx("input",{type:"text",...i("pinCode"),id:"pinCode",autoComplete:"pinCode",className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]})]})]})}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-x-6",children:[e.jsx("button",{onClick:s=>f(!1),type:"button",className:"text-sm font-semibold leading-6 text-gray-900",children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Add"})]})]}),e.jsxs("div",{className:"border-b border-gray-900/10 pb-12",children:[e.jsxs("div",{className:"flex justify-between pt-10 pb-4",children:[e.jsx("h2",{className:"font-semibold leading-7 text-gray-900 text-2xl",children:" Choose from Exixsting Address"}),e.jsx("div",{onClick:s=>f(!0),className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Add New Address"})]}),e.jsx("ul",{role:"list",children:x.addresses.map((s,t)=>e.jsxs("li",{className:"flex justify-between gap-x-6 px-5 py-5 border-solid border-2 border-gray-200 m-4",children:[e.jsxs("div",{className:"flex min-w-0 gap-x-4",children:[e.jsx("input",{name:"address",onChange:a=>N(s),type:"radio",value:t,className:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-600"}),e.jsxs("div",{className:"min-w-0 flex-auto",children:[e.jsx("p",{className:"text-sm font-semibold leading-6 text-gray-900",children:s.firstName}),e.jsxs("p",{className:"mt-1 truncate text-xs leading-5 text-gray-500",children:[s.street,",",s.city]}),e.jsx("p",{className:"mt-1 truncate text-xs leading-5 text-gray-500",children:s.country})]})]}),e.jsxs("div",{className:"hidden shrink-0 sm:flex sm:flex-col sm:items-end",children:[e.jsxs("p",{className:"text-sm leading-6 text-gray-900",children:["Pincode : ",s.pinCode]}),e.jsx("p",{className:"text-sm leading-6 text-gray-900",children:s.state})]})]},t))})]}),e.jsx("div",{className:"mt-10 space-y-10",children:e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-sm font-semibold leading-6 text-gray-900",children:"Payment Methods"}),e.jsx("p",{className:"mt-1 text-sm leading-6 text-gray-600",children:"Choose One"}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("input",{id:"cash",onChange:s=>u(s.target.value),value:"cash",name:"payments",type:"radio",className:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-600"}),e.jsx("label",{htmlFor:"cash",className:"block text-sm font-medium leading-6 text-gray-900",children:"Cash"})]}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("input",{id:"card",onChange:s=>u(s.target.value),value:"card",name:"payments",type:"radio",className:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-600"}),e.jsx("label",{htmlFor:"card",className:"block text-sm font-medium leading-6 text-gray-900",children:"Card"})]})]})]})})]}),e.jsx("div",{children:r&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"flow-root",children:e.jsx("ul",{role:"list",className:"-my-6 divide-y divide-gray-200",children:r==null?void 0:r.map(s=>e.jsxs("li",{className:"flex py-6",children:[e.jsx("div",{className:"h-24 w-24 flex-shrink-0 overflow-hidden rounded-md border border-gray-200",children:e.jsx("img",{src:s.itemId.thumbnail,alt:s.itemId.title,className:"h-full w-full object-cover object-center"})}),e.jsxs("div",{className:"ml-4 flex flex-1 flex-col",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[e.jsx("h3",{children:e.jsx("a",{href:"#",children:s.itemId.title})}),e.jsxs("p",{className:"ml-4",children:["$ ",s.itemId.price]})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s.itemId.brand})]}),e.jsxs("div",{className:"flex flex-1 items-end justify-between text-sm",children:[e.jsx("p",{className:"text-gray-500 flex flex-row gap-2 uppercase",children:s.itemId.category}),e.jsxs("div",{className:"flex",children:["Quantity : ",s.quantity]})]})]})]},s._id))})}),e.jsx("button",{onClick:s=>k(r),className:" w-full rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-6",children:"Order"})]})})})]})})}function $(){return e.jsx("div",{children:e.jsx(Q,{})})}export{$ as default};
